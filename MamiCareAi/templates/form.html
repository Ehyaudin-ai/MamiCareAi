<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAMICARE AI - Preeclampsia Screening</title>
    <link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='style.css') }}" rel="stylesheet">
</head>
<body>
    <div class="container py-4">
        <!-- Header -->
        <div class="text-center mb-4">
            <h1 class="display-5 fw-bold text-info">
                <i class="fas fa-heartbeat me-2"></i>MAMICARE AI
            </h1>
            <p class="lead text-muted">Preeclampsia Risk Screening Tool</p>
            <p class="small text-muted">For rural clinic use - Offline capable</p>
        </div>

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ 'danger' if category == 'error' else 'info' }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <!-- Main Form -->
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="card">
                    <div class="card-header">
                        <h4 class="mb-0">
                            <i class="fas fa-user-md me-2"></i>Patient Assessment Form
                        </h4>
                    </div>
                    <div class="card-body">
                        <form method="POST" action="{{ url_for('predict') }}" class="needs-validation" novalidate>
                            
                            <!-- Blood Pressure Section -->
                            <div class="row mb-4">
                                <div class="col-12">
                                    <h5 class="text-info mb-3">
                                        <i class="fas fa-tachometer-alt me-2"></i>Blood Pressure
                                    </h5>
                                </div>
                                <div class="col-md-6">
                                    <label for="systolic_bp" class="form-label">
                                        Systolic BP <span class="text-danger">*</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="systolic_bp" 
                                               name="systolic_bp" min="80" max="250" required>
                                        <span class="input-group-text">mmHg</span>
                                    </div>
                                    <div class="form-text">Normal: 90-140 mmHg</div>
                                </div>
                                <div class="col-md-6">
                                    <label for="diastolic_bp" class="form-label">
                                        Diastolic BP <span class="text-danger">*</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="diastolic_bp" 
                                               name="diastolic_bp" min="40" max="150" required>
                                        <span class="input-group-text">mmHg</span>
                                    </div>
                                    <div class="form-text">Normal: 60-90 mmHg</div>
                                </div>
                            </div>

                            <!-- Urine Protein -->
                            <div class="mb-4">
                                <h5 class="text-info mb-3">
                                    <i class="fas fa-vial me-2"></i>Laboratory
                                </h5>
                                <label for="urine_protein" class="form-label">
                                    Urine Protein Level <span class="text-danger">*</span>
                                </label>
                                <select class="form-select" id="urine_protein" name="urine_protein" required>
                                    <option value="">Select protein level...</option>
                                    <option value="negative">Negative</option>
                                    <option value="trace">Trace</option>
                                    <option value="1+">1+ (30 mg/dL)</option>
                                    <option value="2+">2+ (100 mg/dL)</option>
                                    <option value="3+">3+ (300 mg/dL)</option>
                                </select>
                                <div class="form-text">Use dipstick or urinalysis results</div>
                            </div>

                            <!-- Maternal Information -->
                            <div class="row mb-4">
                                <div class="col-12">
                                    <h5 class="text-info mb-3">
                                        <i class="fas fa-female me-2"></i>Maternal Information
                                    </h5>
                                </div>
                                <div class="col-md-4">
                                    <label for="maternal_age" class="form-label">
                                        Age <span class="text-danger">*</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="maternal_age" 
                                               name="maternal_age" min="12" max="55" required>
                                        <span class="input-group-text">years</span>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <label for="gravida" class="form-label">
                                        Gravida <span class="text-danger">*</span>
                                    </label>
                                    <input type="number" class="form-control" id="gravida" 
                                           name="gravida" min="1" max="20" required>
                                    <div class="form-text">Total pregnancies</div>
                                </div>
                                <div class="col-md-4">
                                    <label for="parity" class="form-label">
                                        Parity <span class="text-danger">*</span>
                                    </label>
                                    <input type="number" class="form-control" id="parity" 
                                           name="parity" min="0" max="15" required>
                                    <div class="form-text">Prior deliveries</div>
                                </div>
                            </div>

                            <!-- Medical History -->
                            <div class="row mb-4">
                                <div class="col-12">
                                    <h5 class="text-info mb-3">
                                        <i class="fas fa-history me-2"></i>Medical History
                                    </h5>
                                </div>
                                <div class="col-md-6">
                                    <label for="history_preeclampsia" class="form-label">
                                        History of Preeclampsia <span class="text-danger">*</span>
                                    </label>
                                    <select class="form-select" id="history_preeclampsia" name="history_preeclampsia" required>
                                        <option value="">Select...</option>
                                        <option value="no">No</option>
                                        <option value="yes">Yes</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label for="gestational_age" class="form-label">
                                        Gestational Age <span class="text-danger">*</span>
                                    </label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="gestational_age" 
                                               name="gestational_age" min="20" max="42" required>
                                        <span class="input-group-text">weeks</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Symptoms -->
                            <div class="mb-4">
                                <h5 class="text-info mb-3">
                                    <i class="fas fa-stethoscope me-2"></i>Current Symptoms
                                </h5>
                                <label for="symptoms" class="form-label">
                                    Symptoms (if any)
                                </label>
                                <textarea class="form-control" id="symptoms" name="symptoms" rows="3" 
                                          placeholder="Enter symptoms separated by commas (e.g., headache, vision problems, swelling)"></textarea>
                                <div class="form-text">
                                    Common symptoms: headache, vision problems, swelling, epigastric pain, decreased fetal movement
                                </div>
                            </div>

                            <!-- Submit Button -->
                            <div class="d-grid gap-2">
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="fas fa-search me-2"></i>Assess Risk
                                </button>
                            </div>

                        </form>
                    </div>
                </div>

                <!-- Demo Dashboard Link -->
                <div class="card mt-4">
                    <div class="card-body text-center">
                        <h6 class="card-title text-info">
                            <i class="fas fa-microscope me-2"></i>For Examiners & Audiences
                        </h6>
                        <p class="small text-muted mb-3">View comprehensive demonstration with real datasets, research validation, and clinical case studies</p>
                        <a href="{{ url_for('demo_dashboard') }}" class="btn btn-outline-info">
                            <i class="fas fa-chart-line me-2"></i>Open Demo Dashboard
                        </a>
                    </div>
                </div>

                <!-- Information Panel -->
                <div class="card mt-4">
                    <div class="card-body">
                        <h6 class="card-title text-info">
                            <i class="fas fa-info-circle me-2"></i>Clinical Guidelines
        </h6>
                        <div class="row">
                            <div class="col-md-6">
                                <p class="small mb-2"><strong>Blood Pressure Thresholds:</strong></p>
                                <ul class="small">
                                    <li>Mild: ≥140/90 mmHg</li>
                                    <li>Severe: ≥160/110 mmHg</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <p class="small mb-2"><strong>Proteinuria Significance:</strong></p>
                                <ul class="small">
                                    <li>2+ or 3+: Significant proteinuria</li>
                                    <li>Consider 24hr collection if available</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Form validation
        (function() {
            'use strict';
            window.addEventListener('load', function() {
                var forms = document.getElementsByClassName('needs-validation');
                var validation = Array.prototype.filter.call(forms, function(form) {
                    form.addEventListener('submit', function(event) {
                        if (form.checkValidity() === false) {
                            event.preventDefault();
                            event.stopPropagation();
                        }
                        form.classList.add('was-validated');
                    }, false);
                });
            }, false);
        })();

        // Parity validation (cannot exceed gravida)
        document.getElementById('gravida').addEventListener('input', function() {
            const gravida = parseInt(this.value) || 0;
            const parityInput = document.getElementById('parity');
            parityInput.max = Math.max(0, gravida - 1);
            
            if (parseInt(parityInput.value) > gravida - 1) {
                parityInput.value = Math.max(0, gravida - 1);
            }
        });

        document.getElementById('parity').addEventListener('input', function() {
            const parity = parseInt(this.value) || 0;
            const gravida = parseInt(document.getElementById('gravida').value) || 0;
            
            if (parity >= gravida) {
                this.value = Math.max(0, gravida - 1);
            }
        });
    </script>
</body>
</html>
